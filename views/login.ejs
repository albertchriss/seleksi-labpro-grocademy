<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grocademy - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .gradient-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      }
      .gradient-gold {
        background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen flex items-center justify-center p-5">
    <div
      class="bg-white rounded-3xl p-10 shadow-2xl w-full max-w-md text-center"
    >
      <div
        class="w-20 h-20 gradient-gold rounded-2xl mx-auto mb-5 flex items-center justify-center text-4xl"
      >
        ðŸŽ“
      </div>
      <h1 id="page-title" class="text-primary-600 text-3xl font-semibold mb-2">
        Grocademy Login
      </h1>
      <p class="text-gray-400 text-sm mb-8" id="page-subtitle">
        Masuk untuk mengakses dashboard
      </p>

      <div id="message-container" class="mb-5"></div>

      <form id="auth-form" class="space-y-5">
        <!-- Login Form -->
        <div id="login-form" class="space-y-5">
          <div class="text-left">
            <label
              for="login-identifier"
              class="block text-primary-600 text-sm font-medium mb-2"
              >Email atau Username</label
            >
            <input
              type="text"
              id="login-identifier"
              name="identifier"
              placeholder="admin@example.com"
              required
              class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
            />
          </div>
          <div class="text-left">
            <label
              for="login-password"
              class="block text-primary-600 text-sm font-medium mb-2"
              >Kata Sandi</label
            >
            <input
              type="password"
              id="login-password"
              name="password"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              required
              class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
            />
          </div>
          <div class="flex flex-col gap-2 mb-5">
            <button
              type="submit"
              class="w-full p-4 gradient-primary text-white border-0 rounded-xl text-base font-semibold cursor-pointer transition-transform hover:-translate-y-0.5 active:translate-y-0"
              id="login-btn"
            >
              Masuk ke Grocademy
            </button>
            <a
              href="/api/auth/google"
              class="flex-1 px-4 py-2 flex items-center justify-center gap-2 bg-gray-50 text-primary-600 border-2 border-gray-200 rounded-xl text-base font-semibold transition-transform hover:-translate-y-0.5 active:translate-y-0"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                x="0px"
                y="0px"
                width="30"
                height="30"
                viewBox="0 0 48 48"
              >
                <path
                  fill="#FFC107"
                  d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"
                ></path>
                <path
                  fill="#FF3D00"
                  d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
                ></path>
                <path
                  fill="#4CAF50"
                  d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"
                ></path>
                <path
                  fill="#1976D2"
                  d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"
                ></path>
              </svg>
              Google
            </a>
          </div>
        </div>

        <!-- Register Form -->
        <div id="register-form" class="flex flex-col space-y-5 hidden">
          <div class="flex flex-col space-y-2">

            <div class="text-left">
              <label
                for="register-email"
                class="block text-primary-600 text-sm font-medium mb-2"
                >Email</label
              >
              <input
                type="email"
                id="register-email"
                name="email"
                placeholder="your@email.com"
                class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
              />
            </div>
            <div class="text-left">
              <label
                for="register-username"
                class="block text-primary-600 text-sm font-medium mb-2"
                >Username</label
              >
              <input
                type="text"
                id="register-username"
                name="username"
                placeholder="username"
                class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
              />
            </div>
            <div class="text-left">
              <label
                for="register-first-name"
                class="block text-primary-600 text-sm font-medium mb-2"
                >Nama Depan</label
              >
              <input
                type="text"
                id="register-first-name"
                name="first_name"
                placeholder="John"
                class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
              />
            </div>
            <div class="text-left">
              <label
                for="register-last-name"
                class="block text-primary-600 text-sm font-medium mb-2"
                >Nama Belakang</label
              >
              <input
                type="text"
                id="register-last-name"
                name="last_name"
                placeholder="Doe"
                class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
              />
            </div>
            <div class="text-left">
              <label
                for="register-password"
                class="block text-primary-600 text-sm font-medium mb-2"
                >Kata Sandi</label
              >
              <input
                type="password"
                id="register-password"
                name="password"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                minlength="8"
                class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
              />
            </div>
            <div class="text-left">
              <label
                for="confirm-password"
                class="block text-primary-600 text-sm font-medium mb-2"
                >Konfirmasi Kata Sandi</label
              >
              <input
                type="password"
                id="confirm-password"
                name="password"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                minlength="8"
                class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors focus:outline-none focus:border-primary-500 bg-gray-50 focus:bg-white"
              />
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <button
              type="submit"
              class="w-full p-4 gradient-primary text-white border-0 rounded-xl text-base font-semibold cursor-pointer transition-transform hover:-translate-y-0.5 active:translate-y-0"
              id="register-btn"
            >
              Daftar ke Grocademy
            </button>
            <a
              href="/api/auth/google"
              class="flex-1 px-4 py-2 flex items-center justify-center gap-2 bg-gray-50 text-primary-600 border-2 border-gray-200 rounded-xl text-base font-semibold transition-transform hover:-translate-y-0.5 active:translate-y-0"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                x="0px"
                y="0px"
                width="30"
                height="30"
                viewBox="0 0 48 48"
              >
                <path
                  fill="#FFC107"
                  d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"
                ></path>
                <path
                  fill="#FF3D00"
                  d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
                ></path>
                <path
                  fill="#4CAF50"
                  d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"
                ></path>
                <path
                  fill="#1976D2"
                  d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"
                ></path>
              </svg>
              Google
            </a>
          </div>
        </div>
      </form>

      <a
        href="#"
        class="text-primary-600 no-underline text-sm font-medium flex items-center justify-center gap-1 hover:underline mt-2"
        id="switch-mode"
      >
        <span>ðŸ”„</span>
        <span id="switch-text">Belum punya akun? Daftar sekarang</span>
      </a>
    </div>

    <script>
      let isLoginMode = false;

      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const pageTitle = document.getElementById('page-title');
      const pageSubtitle = document.getElementById('page-subtitle');
      const switchMode = document.getElementById('switch-mode');
      const switchText = document.getElementById('switch-text');
      const authForm = document.getElementById('auth-form');
      const messageContainer = document.getElementById('message-container');

      function showMessage(message, type = 'error') {
        const className =
          type === 'error'
            ? 'bg-red-100 text-red-600'
            : 'bg-green-100 text-green-600';
        messageContainer.innerHTML = `<div class="${className} p-3 rounded-lg text-sm">${message}</div>`;
        setTimeout(() => {
          messageContainer.innerHTML = '';
        }, 5000);
      }

      function toggleMode() {
        isLoginMode = !isLoginMode;

        if (isLoginMode) {
          loginForm.classList.remove('hidden');
          registerForm.classList.add('hidden');
          pageTitle.textContent = 'Grocademy Login';
          pageSubtitle.textContent = 'Masuk untuk mengakses dashboard';
          switchText.textContent = 'Belum punya akun? Daftar sekarang';

          // Enable required validation for login fields
          document.getElementById('login-identifier').required = true;
          document.getElementById('login-password').required = true;

          // Disable required validation for register fields
          document.getElementById('register-email').required = false;
          document.getElementById('register-username').required = false;
          document.getElementById('register-first-name').required = false;
          document.getElementById('register-last-name').required = false;
          document.getElementById('register-password').required = false;
        } else {
          loginForm.classList.add('hidden');
          registerForm.classList.remove('hidden');
          pageTitle.textContent = 'Grocademy Register';
          pageSubtitle.textContent = 'Buat akun baru untuk memulai';
          switchText.textContent = 'Sudah punya akun? Masuk sekarang';

          // Disable required validation for login fields
          document.getElementById('login-identifier').required = false;
          document.getElementById('login-password').required = false;

          // Enable required validation for register fields
          document.getElementById('register-email').required = true;
          document.getElementById('register-username').required = true;
          document.getElementById('register-first-name').required = true;
          document.getElementById('register-last-name').required = true;
          document.getElementById('register-password').required = true;
          document.getElementById('confirm-password').required = true;
        }

        messageContainer.innerHTML = '';
      }

      switchMode.addEventListener('click', (e) => {
        e.preventDefault();
        toggleMode();
      });

      authForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Check form validity
        const isValid = authForm.checkValidity();

        if (!isValid) {
          authForm.reportValidity();
          return;
        }

        const container = document.querySelector('.bg-white');
        container.classList.add('opacity-70', 'pointer-events-none');

        try {
          let formData;
          let endpoint;

          if (isLoginMode) {
            formData = {
              identifier: document.getElementById('login-identifier').value,
              password: document.getElementById('login-password').value,
            };
            endpoint = '/api/auth/login';
          } else {
            const password = document.getElementById('register-password').value;
            const confirmPassword =
              document.getElementById('confirm-password').value;
            if (password !== confirmPassword) {
              showMessage(
                'Kata sandi dan konfirmasi kata sandi tidak cocok',
                'error',
              );
              return;
            }
            formData = {
              email: document.getElementById('register-email').value,
              username: document.getElementById('register-username').value,
              first_name: document.getElementById('register-first-name').value,
              last_name: document.getElementById('register-last-name').value,
              password: document.getElementById('register-password').value,
              confirm_password:
                document.getElementById('confirm-password').value,
            };
            endpoint = '/api/auth/register';
          }

          const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });

          const result = await response.json();

          if (response.ok) {
            if (isLoginMode) {
              showMessage('Login berhasil!', 'success');
              localStorage.setItem('token', result.data.token);
              setTimeout(() => {
                window.location.href = '/courses';
              }, 1000);
            } else {
              showMessage('Registrasi berhasil! Silakan login.', 'success');
              setTimeout(() => {
                toggleMode();
              }, 1500);
            }
          } else {
            showMessage(result.message || 'Terjadi kesalahan');
          }
        } catch (error) {
          console.error('Network error:', error); // Debug log
          showMessage('Terjadi kesalahan jaringan');
        } finally {
          container.classList.remove('opacity-70', 'pointer-events-none');
        }
      });

      const token = localStorage.getItem('token');
      if (token) {
        window.location.href = '/courses';
      }

      toggleMode();
    </script>
  </body>
</html>
